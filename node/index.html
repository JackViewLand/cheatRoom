<html>
<body>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
$(document).ready(function(){
  $('#txtInput').keypress(function(e) {
    var key = window.event ? e.keyCode : e.which;
    if (key == 13)
      $('#btnSend').click();
  });
  $("#btnSend").on("click",function(){
    let txt = $("#txtInput").val();
    $("#txtInput").val("");
    ws.send(txt);
  })
})
//使用 WebSocket 的網址向 Server 開啟連結
var ws = new WebSocket('ws://web.jack0420.shop/ws')

ws.onopen = () => {
  console.log('open connection')
}

ws.onclose = () => {
  console.log('close connection');
}

//接收 Server 發送的訊息
ws.onmessage = event => {
  if (typeof event.data === 'string') {
    // 如果訊息是字串，直接顯示在文字框中
    displayMessage(event.data);
  } else if (event.data instanceof Blob) {
    // 如果訊息是 Blob 物件，則處理為 Blob URL，並在文字框中顯示連結
    displayBlobURL(event.data);
  }
}

// 顯示文字訊息
function displayMessage(message) {
  if (!$("#txtShow").val()) {
    $("#txtShow").val(message);
  } else {
    $("#txtShow").val($("#txtShow").val() + "\n" + message);
  }
}

// 顯示 Blob 物件的 URL
function displayBlobURL(blob) {
  var reader = new FileReader();
  reader.onload = function(event) {
    var url = event.target.result;
    var link = document.createElement('a');
    link.href = url;
    link.innerText = 'Download File';
    $("#txtShow").append(link);
  };
  reader.readAsDataURL(blob);
}

</script>
<textarea id="txtShow" style="height:60vmin;width:80vmin" disabled></textarea></br>
<input id="txtInput" style="width:80vmin" type="text"><input type="button" id="btnSend" value="送出">
</body>
</html>
